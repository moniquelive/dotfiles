var yr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uo(At){return At&&At.__esModule&&Object.prototype.hasOwnProperty.call(At,"default")?At.default:At}var We={exports:{}};We.exports;var yn;function fo(){return yn||(yn=1,(function(At,_e){(function(Br,Ge){At.exports=Ge()})(self,(()=>(()=>{var Br={227:(z,h,k)=>{var M=k(155);h.formatArgs=function(N){if(N[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+N[0]+(this.useColors?"%c ":" ")+"+"+z.exports.humanize(this.diff),!this.useColors)return;const J="color: "+this.color;N.splice(1,0,J,"color: inherit");let v=0,p=0;N[0].replace(/%[a-zA-Z%]/g,(_=>{_!=="%%"&&(v++,_==="%c"&&(p=v))})),N.splice(p,0,J)},h.save=function(N){try{N?h.storage.setItem("debug",N):h.storage.removeItem("debug")}catch{}},h.load=function(){let N;try{N=h.storage.getItem("debug")}catch{}return!N&&M!==void 0&&"env"in M&&(N=M.env.DEBUG),N},h.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},h.storage=(function(){try{return localStorage}catch{}})(),h.destroy=(()=>{let N=!1;return()=>{N||(N=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),h.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],h.log=console.debug||console.log||(()=>{}),z.exports=k(447)(h);const{formatters:A}=z.exports;A.j=function(N){try{return JSON.stringify(N)}catch(J){return"[UnexpectedJSONParseError]: "+J.message}}},447:(z,h,k)=>{z.exports=function(M){function A(v){let p,_,u,w=null;function y(...E){if(!y.enabled)return;const R=y,j=Number(new Date),T=j-(p||j);R.diff=T,R.prev=p,R.curr=j,p=j,E[0]=A.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let i=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,((l,m)=>{if(l==="%%")return"%";i++;const g=A.formatters[m];if(typeof g=="function"){const q=E[i];l=g.call(R,q),E.splice(i,1),i--}return l})),A.formatArgs.call(R,E),(R.log||A.log).apply(R,E)}return y.namespace=v,y.useColors=A.useColors(),y.color=A.selectColor(v),y.extend=N,y.destroy=A.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>w!==null?w:(_!==A.namespaces&&(_=A.namespaces,u=A.enabled(v)),u),set:E=>{w=E}}),typeof A.init=="function"&&A.init(y),y}function N(v,p){const _=A(this.namespace+(p===void 0?":":p)+v);return _.log=this.log,_}function J(v){return v.toString().substring(2,v.toString().length-2).replace(/\.\*\?$/,"*")}return A.debug=A,A.default=A,A.coerce=function(v){return v instanceof Error?v.stack||v.message:v},A.disable=function(){const v=[...A.names.map(J),...A.skips.map(J).map((p=>"-"+p))].join(",");return A.enable(""),v},A.enable=function(v){let p;A.save(v),A.namespaces=v,A.names=[],A.skips=[];const _=(typeof v=="string"?v:"").split(/[\s,]+/),u=_.length;for(p=0;p<u;p++)_[p]&&((v=_[p].replace(/\*/g,".*?"))[0]==="-"?A.skips.push(new RegExp("^"+v.slice(1)+"$")):A.names.push(new RegExp("^"+v+"$")))},A.enabled=function(v){if(v[v.length-1]==="*")return!0;let p,_;for(p=0,_=A.skips.length;p<_;p++)if(A.skips[p].test(v))return!1;for(p=0,_=A.names.length;p<_;p++)if(A.names[p].test(v))return!0;return!1},A.humanize=k(824),A.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(M).forEach((v=>{A[v]=M[v]})),A.names=[],A.skips=[],A.formatters={},A.selectColor=function(v){let p=0;for(let _=0;_<v.length;_++)p=(p<<5)-p+v.charCodeAt(_),p|=0;return A.colors[Math.abs(p)%A.colors.length]},A.enable(A.load()),A}},996:z=>{var h=function(u){return(function(w){return!!w&&typeof w=="object"})(u)&&!(function(w){var y=Object.prototype.toString.call(w);return y==="[object RegExp]"||y==="[object Date]"||(function(E){return E.$$typeof===k})(w)})(u)},k=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function M(u,w){return w.clone!==!1&&w.isMergeableObject(u)?p((y=u,Array.isArray(y)?[]:{}),u,w):u;var y}function A(u,w,y){return u.concat(w).map((function(E){return M(E,y)}))}function N(u){return Object.keys(u).concat((function(w){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(w).filter((function(y){return Object.propertyIsEnumerable.call(w,y)})):[]})(u))}function J(u,w){try{return w in u}catch{return!1}}function v(u,w,y){var E={};return y.isMergeableObject(u)&&N(u).forEach((function(R){E[R]=M(u[R],y)})),N(w).forEach((function(R){(function(j,T){return J(j,T)&&!(Object.hasOwnProperty.call(j,T)&&Object.propertyIsEnumerable.call(j,T))})(u,R)||(J(u,R)&&y.isMergeableObject(w[R])?E[R]=(function(j,T){if(!T.customMerge)return p;var i=T.customMerge(j);return typeof i=="function"?i:p})(R,y)(u[R],w[R],y):E[R]=M(w[R],y))})),E}function p(u,w,y){(y=y||{}).arrayMerge=y.arrayMerge||A,y.isMergeableObject=y.isMergeableObject||h,y.cloneUnlessOtherwiseSpecified=M;var E=Array.isArray(w);return E===Array.isArray(u)?E?y.arrayMerge(u,w,y):v(u,w,y):M(w,y)}p.all=function(u,w){if(!Array.isArray(u))throw new Error("first argument should be an array");return u.reduce((function(y,E){return p(y,E,w)}),{})};var _=p;z.exports=_},856:function(z){z.exports=(function(){function h(C){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},h(C)}function k(C,I){return k=Object.setPrototypeOf||function($,G){return $.__proto__=G,$},k(C,I)}function M(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}function A(C,I,$){return A=M()?Reflect.construct:function(G,ct,Ft){var zt=[null];zt.push.apply(zt,ct);var Yt=new(Function.bind.apply(G,zt));return Ft&&k(Yt,Ft.prototype),Yt},A.apply(null,arguments)}function N(C){return J(C)||v(C)||p(C)||u()}function J(C){if(Array.isArray(C))return _(C)}function v(C){if(typeof Symbol<"u"&&C[Symbol.iterator]!=null||C["@@iterator"]!=null)return Array.from(C)}function p(C,I){if(C){if(typeof C=="string")return _(C,I);var $=Object.prototype.toString.call(C).slice(8,-1);return $==="Object"&&C.constructor&&($=C.constructor.name),$==="Map"||$==="Set"?Array.from(C):$==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($)?_(C,I):void 0}}function _(C,I){(I==null||I>C.length)&&(I=C.length);for(var $=0,G=new Array(I);$<I;$++)G[$]=C[$];return G}function u(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var w=Object.hasOwnProperty,y=Object.setPrototypeOf,E=Object.isFrozen,R=Object.getPrototypeOf,j=Object.getOwnPropertyDescriptor,T=Object.freeze,i=Object.seal,l=Object.create,m=typeof Reflect<"u"&&Reflect,g=m.apply,q=m.construct;g||(g=function(C,I,$){return C.apply(I,$)}),T||(T=function(C){return C}),i||(i=function(C){return C}),q||(q=function(C,I){return A(C,N(I))});var K=V(Array.prototype.forEach),et=V(Array.prototype.pop),at=V(Array.prototype.push),gt=V(String.prototype.toLowerCase),vt=V(String.prototype.match),dt=V(String.prototype.replace),we=V(String.prototype.indexOf),f=V(String.prototype.trim),b=V(RegExp.prototype.test),D=bt(TypeError);function V(C){return function(I){for(var $=arguments.length,G=new Array($>1?$-1:0),ct=1;ct<$;ct++)G[ct-1]=arguments[ct];return g(C,I,G)}}function bt(C){return function(){for(var I=arguments.length,$=new Array(I),G=0;G<I;G++)$[G]=arguments[G];return q(C,$)}}function F(C,I){y&&y(C,null);for(var $=I.length;$--;){var G=I[$];if(typeof G=="string"){var ct=gt(G);ct!==G&&(E(I)||(I[$]=ct),G=ct)}C[G]=!0}return C}function W(C){var I,$=l(null);for(I in C)g(w,C,[I])&&($[I]=C[I]);return $}function tt(C,I){for(;C!==null;){var $=j(C,I);if($){if($.get)return V($.get);if(typeof $.value=="function")return V($.value)}C=R(C)}function G(ct){return console.warn("fallback value for",ct),null}return G}var xt=T(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),yt=T(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),jt=T(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Kt=T(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),it=T(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),nt=T(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),_t=T(["#text"]),Ct=T(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),It=T(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Wt=T(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Et=T(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),St=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ce=i(/<%[\w\W]*|[\w\W]*%>/gm),br=i(/^data-[\-\w.\u00B7-\uFFFF]/),Mt=i(/^aria-[\-\w]+$/),$t=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Je=i(/^(?:\w+script|data):/i),_r=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),wr=i(/^html$/i),le=function(){return typeof window>"u"?null:window},xr=function(C,I){if(h(C)!=="object"||typeof C.createPolicy!="function")return null;var $=null,G="data-tt-policy-suffix";I.currentScript&&I.currentScript.hasAttribute(G)&&($=I.currentScript.getAttribute(G));var ct="dompurify"+($?"#"+$:"");try{return C.createPolicy(ct,{createHTML:function(Ft){return Ft}})}catch{return console.warn("TrustedTypes policy "+ct+" could not be created."),null}};function Ze(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:le(),I=function(o){return Ze(o)};if(I.version="2.3.8",I.removed=[],!C||!C.document||C.document.nodeType!==9)return I.isSupported=!1,I;var $=C.document,G=C.document,ct=C.DocumentFragment,Ft=C.HTMLTemplateElement,zt=C.Node,Yt=C.Element,Me=C.NodeFilter,Ve=C.NamedNodeMap,Gt=Ve===void 0?C.NamedNodeMap||C.MozNamedAttrMap:Ve,Cr=C.HTMLFormElement,Sr=C.DOMParser,Or=C.trustedTypes,xe=Yt.prototype,Ar=tt(xe,"cloneNode"),jr=tt(xe,"nextSibling"),Er=tt(xe,"childNodes"),Fe=tt(xe,"parentNode");if(typeof Ft=="function"){var Lt=G.createElement("template");Lt.content&&Lt.content.ownerDocument&&(G=Lt.content.ownerDocument)}var Nt=xr(Or,$),Ke=Nt?Nt.createHTML(""):"",Ce=G,Le=Ce.implementation,Qt=Ce.createNodeIterator,Ye=Ce.createDocumentFragment,Qe=Ce.getElementsByTagName,kr=$.importNode,Xe={};try{Xe=W(G).documentMode?G.documentMode:{}}catch{}var kt={};I.isSupported=typeof Fe=="function"&&Le&&Le.createHTMLDocument!==void 0&&Xe!==9;var ue,Ht,Se=St,Oe=ce,Ne=br,Tr=Mt,tr=Je,Ae=_r,Y=$t,lt=null,er=F({},[].concat(N(xt),N(yt),N(jt),N(it),N(_t))),ut=null,Xt=F({},[].concat(N(Ct),N(It),N(Wt),N(Et))),ot=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),te=null,je=null,Pe=!0,Re=!0,rr=!1,ee=!1,Jt=!1,De=!1,Ue=!1,re=!1,Ee=!1,ne=!1,nr=!0,$e=!0,oe=!1,Pt={},ie=null,or=F({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),ir=null,sr=F({},["audio","video","img","source","image","track"]),ze=null,Zt=F({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),se="http://www.w3.org/1998/Math/MathML",He="http://www.w3.org/2000/svg",qt="http://www.w3.org/1999/xhtml",ke=qt,ar=!1,fe=["application/xhtml+xml","text/html"],pe="text/html",ae=null,Ir=G.createElement("form"),cr=function(o){return o instanceof RegExp||o instanceof Function},qe=function(o){ae&&ae===o||(o&&h(o)==="object"||(o={}),o=W(o),lt="ALLOWED_TAGS"in o?F({},o.ALLOWED_TAGS):er,ut="ALLOWED_ATTR"in o?F({},o.ALLOWED_ATTR):Xt,ze="ADD_URI_SAFE_ATTR"in o?F(W(Zt),o.ADD_URI_SAFE_ATTR):Zt,ir="ADD_DATA_URI_TAGS"in o?F(W(sr),o.ADD_DATA_URI_TAGS):sr,ie="FORBID_CONTENTS"in o?F({},o.FORBID_CONTENTS):or,te="FORBID_TAGS"in o?F({},o.FORBID_TAGS):{},je="FORBID_ATTR"in o?F({},o.FORBID_ATTR):{},Pt="USE_PROFILES"in o&&o.USE_PROFILES,Pe=o.ALLOW_ARIA_ATTR!==!1,Re=o.ALLOW_DATA_ATTR!==!1,rr=o.ALLOW_UNKNOWN_PROTOCOLS||!1,ee=o.SAFE_FOR_TEMPLATES||!1,Jt=o.WHOLE_DOCUMENT||!1,re=o.RETURN_DOM||!1,Ee=o.RETURN_DOM_FRAGMENT||!1,ne=o.RETURN_TRUSTED_TYPE||!1,Ue=o.FORCE_BODY||!1,nr=o.SANITIZE_DOM!==!1,$e=o.KEEP_CONTENT!==!1,oe=o.IN_PLACE||!1,Y=o.ALLOWED_URI_REGEXP||Y,ke=o.NAMESPACE||qt,o.CUSTOM_ELEMENT_HANDLING&&cr(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ot.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&cr(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ot.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ot.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ue=ue=fe.indexOf(o.PARSER_MEDIA_TYPE)===-1?pe:o.PARSER_MEDIA_TYPE,Ht=ue==="application/xhtml+xml"?function(O){return O}:gt,ee&&(Re=!1),Ee&&(re=!0),Pt&&(lt=F({},N(_t)),ut=[],Pt.html===!0&&(F(lt,xt),F(ut,Ct)),Pt.svg===!0&&(F(lt,yt),F(ut,It),F(ut,Et)),Pt.svgFilters===!0&&(F(lt,jt),F(ut,It),F(ut,Et)),Pt.mathMl===!0&&(F(lt,it),F(ut,Wt),F(ut,Et))),o.ADD_TAGS&&(lt===er&&(lt=W(lt)),F(lt,o.ADD_TAGS)),o.ADD_ATTR&&(ut===Xt&&(ut=W(ut)),F(ut,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&F(ze,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(ie===or&&(ie=W(ie)),F(ie,o.FORBID_CONTENTS)),$e&&(lt["#text"]=!0),Jt&&F(lt,["html","head","body"]),lt.table&&(F(lt,["tbody"]),delete te.tbody),T&&T(o),ae=o)},lr=F({},["mi","mo","mn","ms","mtext"]),ur=F({},["foreignobject","desc","title","annotation-xml"]),Mr=F({},["title","style","font","a","script"]),Rt=F({},yt);F(Rt,jt),F(Rt,Kt);var Te=F({},it);F(Te,nt);var Fr=function(o){var O=Fe(o);O&&O.tagName||(O={namespaceURI:qt,tagName:"template"});var x=gt(o.tagName),Q=gt(O.tagName);return o.namespaceURI===He?O.namespaceURI===qt?x==="svg":O.namespaceURI===se?x==="svg"&&(Q==="annotation-xml"||lr[Q]):!!Rt[x]:o.namespaceURI===se?O.namespaceURI===qt?x==="math":O.namespaceURI===He?x==="math"&&ur[Q]:!!Te[x]:o.namespaceURI===qt&&!(O.namespaceURI===He&&!ur[Q])&&!(O.namespaceURI===se&&!lr[Q])&&!Te[x]&&(Mr[x]||!Rt[x])},Dt=function(o){at(I.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=Ke}catch{o.remove()}}},he=function(o,O){try{at(I.removed,{attribute:O.getAttributeNode(o),from:O})}catch{at(I.removed,{attribute:null,from:O})}if(O.removeAttribute(o),o==="is"&&!ut[o])if(re||Ee)try{Dt(O)}catch{}else try{O.setAttribute(o,"")}catch{}},fr=function(o){var O,x;if(Ue)o="<remove></remove>"+o;else{var Q=vt(o,/^[\r\n\t ]+/);x=Q&&Q[0]}ue==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var st=Nt?Nt.createHTML(o):o;if(ke===qt)try{O=new Sr().parseFromString(st,ue)}catch{}if(!O||!O.documentElement){O=Le.createDocument(ke,"template",null);try{O.documentElement.innerHTML=ar?"":st}catch{}}var mt=O.body||O.documentElement;return o&&x&&mt.insertBefore(G.createTextNode(x),mt.childNodes[0]||null),ke===qt?Qe.call(O,Jt?"html":"body")[0]:Jt?O.documentElement:mt},pr=function(o){return Qt.call(o.ownerDocument||o,o,Me.SHOW_ELEMENT|Me.SHOW_COMMENT|Me.SHOW_TEXT,null,!1)},Lr=function(o){return o instanceof Cr&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Gt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},de=function(o){return h(zt)==="object"?o instanceof zt:o&&h(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},wt=function(o,O,x){kt[o]&&K(kt[o],(function(Q){Q.call(I,O,x,ae)}))},me=function(o){var O;if(wt("beforeSanitizeElements",o,null),Lr(o)||b(/[\u0080-\uFFFF]/,o.nodeName))return Dt(o),!0;var x=Ht(o.nodeName);if(wt("uponSanitizeElement",o,{tagName:x,allowedTags:lt}),o.hasChildNodes()&&!de(o.firstElementChild)&&(!de(o.content)||!de(o.content.firstElementChild))&&b(/<[/\w]/g,o.innerHTML)&&b(/<[/\w]/g,o.textContent)||x==="select"&&b(/<template/i,o.innerHTML))return Dt(o),!0;if(!lt[x]||te[x]){if(!te[x]&&Vt(x)&&(ot.tagNameCheck instanceof RegExp&&b(ot.tagNameCheck,x)||ot.tagNameCheck instanceof Function&&ot.tagNameCheck(x)))return!1;if($e&&!ie[x]){var Q=Fe(o)||o.parentNode,st=Er(o)||o.childNodes;if(st&&Q)for(var mt=st.length-1;mt>=0;--mt)Q.insertBefore(Ar(st[mt],!0),jr(o))}return Dt(o),!0}return o instanceof Yt&&!Fr(o)?(Dt(o),!0):x!=="noscript"&&x!=="noembed"||!b(/<\/no(script|embed)/i,o.innerHTML)?(ee&&o.nodeType===3&&(O=o.textContent,O=dt(O,Se," "),O=dt(O,Oe," "),o.textContent!==O&&(at(I.removed,{element:o.cloneNode()}),o.textContent=O)),wt("afterSanitizeElements",o,null),!1):(Dt(o),!0)},hr=function(o,O,x){if(nr&&(O==="id"||O==="name")&&(x in G||x in Ir))return!1;if(!(Re&&!je[O]&&b(Ne,O))){if(!(Pe&&b(Tr,O))){if(!ut[O]||je[O]){if(!(Vt(o)&&(ot.tagNameCheck instanceof RegExp&&b(ot.tagNameCheck,o)||ot.tagNameCheck instanceof Function&&ot.tagNameCheck(o))&&(ot.attributeNameCheck instanceof RegExp&&b(ot.attributeNameCheck,O)||ot.attributeNameCheck instanceof Function&&ot.attributeNameCheck(O))||O==="is"&&ot.allowCustomizedBuiltInElements&&(ot.tagNameCheck instanceof RegExp&&b(ot.tagNameCheck,x)||ot.tagNameCheck instanceof Function&&ot.tagNameCheck(x))))return!1}else if(!ze[O]){if(!b(Y,dt(x,Ae,""))){if((O!=="src"&&O!=="xlink:href"&&O!=="href"||o==="script"||we(x,"data:")!==0||!ir[o])&&!(rr&&!b(tr,dt(x,Ae,"")))){if(x)return!1}}}}}return!0},Vt=function(o){return o.indexOf("-")>0},ge=function(o){var O,x,Q,st;wt("beforeSanitizeAttributes",o,null);var mt=o.attributes;if(mt){var ft={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ut};for(st=mt.length;st--;){var ye=O=mt[st],Bt=ye.name,Ot=ye.namespaceURI;if(x=Bt==="value"?O.value:f(O.value),Q=Ht(Bt),ft.attrName=Q,ft.attrValue=x,ft.keepAttr=!0,ft.forceKeepAttr=void 0,wt("uponSanitizeAttribute",o,ft),x=ft.attrValue,!ft.forceKeepAttr&&(he(Bt,o),ft.keepAttr))if(b(/\/>/i,x))he(Bt,o);else{ee&&(x=dt(x,Se," "),x=dt(x,Oe," "));var Be=Ht(o.nodeName);if(hr(Be,Q,x))try{Ot?o.setAttributeNS(Ot,Bt,x):o.setAttribute(Bt,x),et(I.removed)}catch{}}}wt("afterSanitizeAttributes",o,null)}},Nr=function o(O){var x,Q=pr(O);for(wt("beforeSanitizeShadowDOM",O,null);x=Q.nextNode();)wt("uponSanitizeShadowNode",x,null),me(x)||(x.content instanceof ct&&o(x.content),ge(x));wt("afterSanitizeShadowDOM",O,null)};return I.sanitize=function(o,O){var x,Q,st,mt,ft;if((ar=!o)&&(o="<!-->"),typeof o!="string"&&!de(o)){if(typeof o.toString!="function")throw D("toString is not a function");if(typeof(o=o.toString())!="string")throw D("dirty is not a string, aborting")}if(!I.isSupported){if(h(C.toStaticHTML)==="object"||typeof C.toStaticHTML=="function"){if(typeof o=="string")return C.toStaticHTML(o);if(de(o))return C.toStaticHTML(o.outerHTML)}return o}if(De||qe(O),I.removed=[],typeof o=="string"&&(oe=!1),oe){if(o.nodeName){var ye=Ht(o.nodeName);if(!lt[ye]||te[ye])throw D("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof zt)(Q=(x=fr("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&Q.nodeName==="BODY"||Q.nodeName==="HTML"?x=Q:x.appendChild(Q);else{if(!re&&!ee&&!Jt&&o.indexOf("<")===-1)return Nt&&ne?Nt.createHTML(o):o;if(!(x=fr(o)))return re?null:ne?Ke:""}x&&Ue&&Dt(x.firstChild);for(var Bt=pr(oe?o:x);st=Bt.nextNode();)st.nodeType===3&&st===mt||me(st)||(st.content instanceof ct&&Nr(st.content),ge(st),mt=st);if(mt=null,oe)return o;if(re){if(Ee)for(ft=Ye.call(x.ownerDocument);x.firstChild;)ft.appendChild(x.firstChild);else ft=x;return ut.shadowroot&&(ft=kr.call($,ft,!0)),ft}var Ot=Jt?x.outerHTML:x.innerHTML;return Jt&&lt["!doctype"]&&x.ownerDocument&&x.ownerDocument.doctype&&x.ownerDocument.doctype.name&&b(wr,x.ownerDocument.doctype.name)&&(Ot="<!DOCTYPE "+x.ownerDocument.doctype.name+`>
`+Ot),ee&&(Ot=dt(Ot,Se," "),Ot=dt(Ot,Oe," ")),Nt&&ne?Nt.createHTML(Ot):Ot},I.setConfig=function(o){qe(o),De=!0},I.clearConfig=function(){ae=null,De=!1},I.isValidAttribute=function(o,O,x){ae||qe({});var Q=Ht(o),st=Ht(O);return hr(Q,st,x)},I.addHook=function(o,O){typeof O=="function"&&(kt[o]=kt[o]||[],at(kt[o],O))},I.removeHook=function(o){if(kt[o])return et(kt[o])},I.removeHooks=function(o){kt[o]&&(kt[o]=[])},I.removeAllHooks=function(){kt={}},I}return Ze()})()},729:z=>{var h=Object.prototype.hasOwnProperty,k="~";function M(){}function A(p,_,u){this.fn=p,this.context=_,this.once=u||!1}function N(p,_,u,w,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var E=new A(u,w||p,y),R=k?k+_:_;return p._events[R]?p._events[R].fn?p._events[R]=[p._events[R],E]:p._events[R].push(E):(p._events[R]=E,p._eventsCount++),p}function J(p,_){--p._eventsCount==0?p._events=new M:delete p._events[_]}function v(){this._events=new M,this._eventsCount=0}Object.create&&(M.prototype=Object.create(null),new M().__proto__||(k=!1)),v.prototype.eventNames=function(){var p,_,u=[];if(this._eventsCount===0)return u;for(_ in p=this._events)h.call(p,_)&&u.push(k?_.slice(1):_);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(p)):u},v.prototype.listeners=function(p){var _=k?k+p:p,u=this._events[_];if(!u)return[];if(u.fn)return[u.fn];for(var w=0,y=u.length,E=new Array(y);w<y;w++)E[w]=u[w].fn;return E},v.prototype.listenerCount=function(p){var _=k?k+p:p,u=this._events[_];return u?u.fn?1:u.length:0},v.prototype.emit=function(p,_,u,w,y,E){var R=k?k+p:p;if(!this._events[R])return!1;var j,T,i=this._events[R],l=arguments.length;if(i.fn){switch(i.once&&this.removeListener(p,i.fn,void 0,!0),l){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,_),!0;case 3:return i.fn.call(i.context,_,u),!0;case 4:return i.fn.call(i.context,_,u,w),!0;case 5:return i.fn.call(i.context,_,u,w,y),!0;case 6:return i.fn.call(i.context,_,u,w,y,E),!0}for(T=1,j=new Array(l-1);T<l;T++)j[T-1]=arguments[T];i.fn.apply(i.context,j)}else{var m,g=i.length;for(T=0;T<g;T++)switch(i[T].once&&this.removeListener(p,i[T].fn,void 0,!0),l){case 1:i[T].fn.call(i[T].context);break;case 2:i[T].fn.call(i[T].context,_);break;case 3:i[T].fn.call(i[T].context,_,u);break;case 4:i[T].fn.call(i[T].context,_,u,w);break;default:if(!j)for(m=1,j=new Array(l-1);m<l;m++)j[m-1]=arguments[m];i[T].fn.apply(i[T].context,j)}}return!0},v.prototype.on=function(p,_,u){return N(this,p,_,u,!1)},v.prototype.once=function(p,_,u){return N(this,p,_,u,!0)},v.prototype.removeListener=function(p,_,u,w){var y=k?k+p:p;if(!this._events[y])return this;if(!_)return J(this,y),this;var E=this._events[y];if(E.fn)E.fn!==_||w&&!E.once||u&&E.context!==u||J(this,y);else{for(var R=0,j=[],T=E.length;R<T;R++)(E[R].fn!==_||w&&!E[R].once||u&&E[R].context!==u)&&j.push(E[R]);j.length?this._events[y]=j.length===1?j[0]:j:J(this,y)}return this},v.prototype.removeAllListeners=function(p){var _;return p?(_=k?k+p:p,this._events[_]&&J(this,_)):(this._events=new M,this._eventsCount=0),this},v.prototype.off=v.prototype.removeListener,v.prototype.addListener=v.prototype.on,v.prefixed=k,v.EventEmitter=v,z.exports=v},717:z=>{typeof Object.create=="function"?z.exports=function(h,k){h.super_=k,h.prototype=Object.create(k.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:z.exports=function(h,k){h.super_=k;var M=function(){};M.prototype=k.prototype,h.prototype=new M,h.prototype.constructor=h}},824:z=>{var h=1e3,k=60*h,M=60*k,A=24*M,N=7*A,J=365.25*A;function v(p,_,u,w){var y=_>=1.5*u;return Math.round(p/u)+" "+w+(y?"s":"")}z.exports=function(p,_){_=_||{};var u=typeof p;if(u==="string"&&p.length>0)return(function(w){if(!((w=String(w)).length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(w);if(y){var E=parseFloat(y[1]);switch((y[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return E*J;case"weeks":case"week":case"w":return E*N;case"days":case"day":case"d":return E*A;case"hours":case"hour":case"hrs":case"hr":case"h":return E*M;case"minutes":case"minute":case"mins":case"min":case"m":return E*k;case"seconds":case"second":case"secs":case"sec":case"s":return E*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return E;default:return}}}})(p);if(u==="number"&&isFinite(p))return _.long?(function(w){var y=Math.abs(w);return y>=A?v(w,y,A,"day"):y>=M?v(w,y,M,"hour"):y>=k?v(w,y,k,"minute"):y>=h?v(w,y,h,"second"):w+" ms"})(p):(function(w){var y=Math.abs(w);return y>=A?Math.round(w/A)+"d":y>=M?Math.round(w/M)+"h":y>=k?Math.round(w/k)+"m":y>=h?Math.round(w/h)+"s":w+"ms"})(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))}},520:(z,h,k)=>{var M=k(155),A=M.platform==="win32",N=k(539);function J(i,l){for(var m=[],g=0;g<i.length;g++){var q=i[g];q&&q!=="."&&(q===".."?m.length&&m[m.length-1]!==".."?m.pop():l&&m.push(".."):m.push(q))}return m}function v(i){for(var l=i.length-1,m=0;m<=l&&!i[m];m++);for(var g=l;g>=0&&!i[g];g--);return m===0&&g===l?i:m>g?[]:i.slice(m,g+1)}var p=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,_=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,u={};function w(i){var l=p.exec(i),m=(l[1]||"")+(l[2]||""),g=l[3]||"",q=_.exec(g);return[m,q[1],q[2],q[3]]}function y(i){var l=p.exec(i),m=l[1]||"",g=!!m&&m[1]!==":";return{device:m,isUnc:g,isAbsolute:g||!!l[2],tail:l[3]}}function E(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}u.resolve=function(){for(var i="",l="",m=!1,g=arguments.length-1;g>=-1;g--){var q;if(g>=0?q=arguments[g]:i?(q=M.env["="+i])&&q.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(q=i+"\\"):q=M.cwd(),!N.isString(q))throw new TypeError("Arguments to path.resolve must be strings");if(q){var K=y(q),et=K.device,at=K.isUnc,gt=K.isAbsolute,vt=K.tail;if((!et||!i||et.toLowerCase()===i.toLowerCase())&&(i||(i=et),m||(l=vt+"\\"+l,m=gt),i&&m))break}}return at&&(i=E(i)),i+(m?"\\":"")+(l=J(l.split(/[\\\/]+/),!m).join("\\"))||"."},u.normalize=function(i){var l=y(i),m=l.device,g=l.isUnc,q=l.isAbsolute,K=l.tail,et=/[\\\/]$/.test(K);return(K=J(K.split(/[\\\/]+/),!q).join("\\"))||q||(K="."),K&&et&&(K+="\\"),g&&(m=E(m)),m+(q?"\\":"")+K},u.isAbsolute=function(i){return y(i).isAbsolute},u.join=function(){for(var i=[],l=0;l<arguments.length;l++){var m=arguments[l];if(!N.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&i.push(m)}var g=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(g=g.replace(/^[\\\/]{2,}/,"\\")),u.normalize(g)},u.relative=function(i,l){i=u.resolve(i),l=u.resolve(l);for(var m=i.toLowerCase(),g=l.toLowerCase(),q=v(l.split("\\")),K=v(m.split("\\")),et=v(g.split("\\")),at=Math.min(K.length,et.length),gt=at,vt=0;vt<at;vt++)if(K[vt]!==et[vt]){gt=vt;break}if(gt==0)return l;var dt=[];for(vt=gt;vt<K.length;vt++)dt.push("..");return(dt=dt.concat(q.slice(gt))).join("\\")},u._makeLong=function(i){if(!N.isString(i))return i;if(!i)return"";var l=u.resolve(i);return/^[a-zA-Z]\:\\/.test(l)?"\\\\?\\"+l:/^\\\\[^?.]/.test(l)?"\\\\?\\UNC\\"+l.substring(2):i},u.dirname=function(i){var l=w(i),m=l[0],g=l[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},u.basename=function(i,l){var m=w(i)[2];return l&&m.substr(-1*l.length)===l&&(m=m.substr(0,m.length-l.length)),m},u.extname=function(i){return w(i)[3]},u.format=function(i){if(!N.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!N.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var m=i.dir,g=i.base||"";return m?m[m.length-1]===u.sep?m+g:m+u.sep+g:g},u.parse=function(i){if(!N.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=w(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},u.sep="\\",u.delimiter=";";var R=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,j={};function T(i){return R.exec(i).slice(1)}j.resolve=function(){for(var i="",l=!1,m=arguments.length-1;m>=-1&&!l;m--){var g=m>=0?arguments[m]:M.cwd();if(!N.isString(g))throw new TypeError("Arguments to path.resolve must be strings");g&&(i=g+"/"+i,l=g[0]==="/")}return(l?"/":"")+(i=J(i.split("/"),!l).join("/"))||"."},j.normalize=function(i){var l=j.isAbsolute(i),m=i&&i[i.length-1]==="/";return(i=J(i.split("/"),!l).join("/"))||l||(i="."),i&&m&&(i+="/"),(l?"/":"")+i},j.isAbsolute=function(i){return i.charAt(0)==="/"},j.join=function(){for(var i="",l=0;l<arguments.length;l++){var m=arguments[l];if(!N.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&(i+=i?"/"+m:m)}return j.normalize(i)},j.relative=function(i,l){i=j.resolve(i).substr(1),l=j.resolve(l).substr(1);for(var m=v(i.split("/")),g=v(l.split("/")),q=Math.min(m.length,g.length),K=q,et=0;et<q;et++)if(m[et]!==g[et]){K=et;break}var at=[];for(et=K;et<m.length;et++)at.push("..");return(at=at.concat(g.slice(K))).join("/")},j._makeLong=function(i){return i},j.dirname=function(i){var l=T(i),m=l[0],g=l[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},j.basename=function(i,l){var m=T(i)[2];return l&&m.substr(-1*l.length)===l&&(m=m.substr(0,m.length-l.length)),m},j.extname=function(i){return T(i)[3]},j.format=function(i){if(!N.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!N.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+j.sep:"")+(i.base||"")},j.parse=function(i){if(!N.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=T(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},j.sep="/",j.delimiter=":",z.exports=A?u:j,z.exports.posix=j,z.exports.win32=u},155:z=>{var h,k,M=z.exports={};function A(){throw new Error("setTimeout has not been defined")}function N(){throw new Error("clearTimeout has not been defined")}function J(j){if(h===setTimeout)return setTimeout(j,0);if((h===A||!h)&&setTimeout)return h=setTimeout,setTimeout(j,0);try{return h(j,0)}catch{try{return h.call(null,j,0)}catch{return h.call(this,j,0)}}}(function(){try{h=typeof setTimeout=="function"?setTimeout:A}catch{h=A}try{k=typeof clearTimeout=="function"?clearTimeout:N}catch{k=N}})();var v,p=[],_=!1,u=-1;function w(){_&&v&&(_=!1,v.length?p=v.concat(p):u=-1,p.length&&y())}function y(){if(!_){var j=J(w);_=!0;for(var T=p.length;T;){for(v=p,p=[];++u<T;)v&&v[u].run();u=-1,T=p.length}v=null,_=!1,(function(i){if(k===clearTimeout)return clearTimeout(i);if((k===N||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(i);try{k(i)}catch{try{return k.call(null,i)}catch{return k.call(this,i)}}})(j)}}function E(j,T){this.fun=j,this.array=T}function R(){}M.nextTick=function(j){var T=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)T[i-1]=arguments[i];p.push(new E(j,T)),p.length!==1||_||J(y)},E.prototype.run=function(){this.fun.apply(null,this.array)},M.title="browser",M.browser=!0,M.env={},M.argv=[],M.version="",M.versions={},M.on=R,M.addListener=R,M.once=R,M.off=R,M.removeListener=R,M.removeAllListeners=R,M.emit=R,M.prependListener=R,M.prependOnceListener=R,M.listeners=function(j){return[]},M.binding=function(j){throw new Error("process.binding is not supported")},M.cwd=function(){return"/"},M.chdir=function(j){throw new Error("process.chdir is not supported")},M.umask=function(){return 0}},384:z=>{z.exports=function(h){return h&&typeof h=="object"&&typeof h.copy=="function"&&typeof h.fill=="function"&&typeof h.readUInt8=="function"}},539:(z,h,k)=>{var M=k(155),A=/%[sdj%]/g;h.format=function(f){if(!i(f)){for(var b=[],D=0;D<arguments.length;D++)b.push(v(arguments[D]));return b.join(" ")}D=1;for(var V=arguments,bt=V.length,F=String(f).replace(A,(function(tt){if(tt==="%%")return"%";if(D>=bt)return tt;switch(tt){case"%s":return String(V[D++]);case"%d":return Number(V[D++]);case"%j":try{return JSON.stringify(V[D++])}catch{return"[Circular]"}default:return tt}})),W=V[D];D<bt;W=V[++D])j(W)||!g(W)?F+=" "+W:F+=" "+v(W);return F},h.deprecate=function(f,b){if(l(k.g.process))return function(){return h.deprecate(f,b).apply(this,arguments)};if(M.noDeprecation===!0)return f;var D=!1;return function(){if(!D){if(M.throwDeprecation)throw new Error(b);M.traceDeprecation?console.trace(b):console.error(b),D=!0}return f.apply(this,arguments)}};var N,J={};function v(f,b){var D={seen:[],stylize:_};return arguments.length>=3&&(D.depth=arguments[2]),arguments.length>=4&&(D.colors=arguments[3]),R(b)?D.showHidden=b:b&&h._extend(D,b),l(D.showHidden)&&(D.showHidden=!1),l(D.depth)&&(D.depth=2),l(D.colors)&&(D.colors=!1),l(D.customInspect)&&(D.customInspect=!0),D.colors&&(D.stylize=p),u(D,f,D.depth)}function p(f,b){var D=v.styles[b];return D?"\x1B["+v.colors[D][0]+"m"+f+"\x1B["+v.colors[D][1]+"m":f}function _(f,b){return f}function u(f,b,D){if(f.customInspect&&b&&et(b.inspect)&&b.inspect!==h.inspect&&(!b.constructor||b.constructor.prototype!==b)){var V=b.inspect(D,f);return i(V)||(V=u(f,V,D)),V}var bt=(function(it,nt){if(l(nt))return it.stylize("undefined","undefined");if(i(nt)){var _t="'"+JSON.stringify(nt).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return it.stylize(_t,"string")}if(T(nt))return it.stylize(""+nt,"number");if(R(nt))return it.stylize(""+nt,"boolean");if(j(nt))return it.stylize("null","null")})(f,b);if(bt)return bt;var F=Object.keys(b),W=(function(it){var nt={};return it.forEach((function(_t,Ct){nt[_t]=!0})),nt})(F);if(f.showHidden&&(F=Object.getOwnPropertyNames(b)),K(b)&&(F.indexOf("message")>=0||F.indexOf("description")>=0))return w(b);if(F.length===0){if(et(b)){var tt=b.name?": "+b.name:"";return f.stylize("[Function"+tt+"]","special")}if(m(b))return f.stylize(RegExp.prototype.toString.call(b),"regexp");if(q(b))return f.stylize(Date.prototype.toString.call(b),"date");if(K(b))return w(b)}var xt,yt="",jt=!1,Kt=["{","}"];return E(b)&&(jt=!0,Kt=["[","]"]),et(b)&&(yt=" [Function"+(b.name?": "+b.name:"")+"]"),m(b)&&(yt=" "+RegExp.prototype.toString.call(b)),q(b)&&(yt=" "+Date.prototype.toUTCString.call(b)),K(b)&&(yt=" "+w(b)),F.length!==0||jt&&b.length!=0?D<0?m(b)?f.stylize(RegExp.prototype.toString.call(b),"regexp"):f.stylize("[Object]","special"):(f.seen.push(b),xt=jt?(function(it,nt,_t,Ct,It){for(var Wt=[],Et=0,St=nt.length;Et<St;++Et)we(nt,String(Et))?Wt.push(y(it,nt,_t,Ct,String(Et),!0)):Wt.push("");return It.forEach((function(ce){ce.match(/^\d+$/)||Wt.push(y(it,nt,_t,Ct,ce,!0))})),Wt})(f,b,D,W,F):F.map((function(it){return y(f,b,D,W,it,jt)})),f.seen.pop(),(function(it,nt,_t){return it.reduce((function(Ct,It){return It.indexOf(`
`)>=0,Ct+It.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?_t[0]+(nt===""?"":nt+`
 `)+" "+it.join(`,
  `)+" "+_t[1]:_t[0]+nt+" "+it.join(", ")+" "+_t[1]})(xt,yt,Kt)):Kt[0]+yt+Kt[1]}function w(f){return"["+Error.prototype.toString.call(f)+"]"}function y(f,b,D,V,bt,F){var W,tt,xt;if((xt=Object.getOwnPropertyDescriptor(b,bt)||{value:b[bt]}).get?tt=xt.set?f.stylize("[Getter/Setter]","special"):f.stylize("[Getter]","special"):xt.set&&(tt=f.stylize("[Setter]","special")),we(V,bt)||(W="["+bt+"]"),tt||(f.seen.indexOf(xt.value)<0?(tt=j(D)?u(f,xt.value,null):u(f,xt.value,D-1)).indexOf(`
`)>-1&&(tt=F?tt.split(`
`).map((function(yt){return"  "+yt})).join(`
`).substr(2):`
`+tt.split(`
`).map((function(yt){return"   "+yt})).join(`
`)):tt=f.stylize("[Circular]","special")),l(W)){if(F&&bt.match(/^\d+$/))return tt;(W=JSON.stringify(""+bt)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(W=W.substr(1,W.length-2),W=f.stylize(W,"name")):(W=W.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),W=f.stylize(W,"string"))}return W+": "+tt}function E(f){return Array.isArray(f)}function R(f){return typeof f=="boolean"}function j(f){return f===null}function T(f){return typeof f=="number"}function i(f){return typeof f=="string"}function l(f){return f===void 0}function m(f){return g(f)&&at(f)==="[object RegExp]"}function g(f){return typeof f=="object"&&f!==null}function q(f){return g(f)&&at(f)==="[object Date]"}function K(f){return g(f)&&(at(f)==="[object Error]"||f instanceof Error)}function et(f){return typeof f=="function"}function at(f){return Object.prototype.toString.call(f)}function gt(f){return f<10?"0"+f.toString(10):f.toString(10)}h.debuglog=function(f){if(l(N)&&(N=M.env.NODE_DEBUG||""),f=f.toUpperCase(),!J[f])if(new RegExp("\\b"+f+"\\b","i").test(N)){var b=M.pid;J[f]=function(){var D=h.format.apply(h,arguments);console.error("%s %d: %s",f,b,D)}}else J[f]=function(){};return J[f]},h.inspect=v,v.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},v.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},h.isArray=E,h.isBoolean=R,h.isNull=j,h.isNullOrUndefined=function(f){return f==null},h.isNumber=T,h.isString=i,h.isSymbol=function(f){return typeof f=="symbol"},h.isUndefined=l,h.isRegExp=m,h.isObject=g,h.isDate=q,h.isError=K,h.isFunction=et,h.isPrimitive=function(f){return f===null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||typeof f=="symbol"||f===void 0},h.isBuffer=k(384);var vt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function dt(){var f=new Date,b=[gt(f.getHours()),gt(f.getMinutes()),gt(f.getSeconds())].join(":");return[f.getDate(),vt[f.getMonth()],b].join(" ")}function we(f,b){return Object.prototype.hasOwnProperty.call(f,b)}h.log=function(){console.log("%s - %s",dt(),h.format.apply(h,arguments))},h.inherits=k(717),h._extend=function(f,b){if(!b||!g(b))return f;for(var D=Object.keys(b),V=D.length;V--;)f[D[V]]=b[D[V]];return f}}},Ge={};function ht(z){var h=Ge[z];if(h!==void 0)return h.exports;var k=Ge[z]={exports:{}};return Br[z].call(k.exports,k,k.exports,ht),k.exports}ht.n=z=>{var h=z&&z.__esModule?()=>z.default:()=>z;return ht.d(h,{a:h}),h},ht.d=(z,h)=>{for(var k in h)ht.o(h,k)&&!ht.o(z,k)&&Object.defineProperty(z,k,{enumerable:!0,get:h[k]})},ht.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),ht.o=(z,h)=>Object.prototype.hasOwnProperty.call(z,h),ht.r=z=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(z,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(z,"__esModule",{value:!0})};var vr={};return(()=>{ht.r(vr),ht.d(vr,{LSPluginUser:()=>qr,setupPluginUserInstance:()=>gn});var z=ht(520),h=(ht(856),ht(996)),k=ht.n(h),M=function(){return M=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},M.apply(this,arguments)};function A(e){return e.toLowerCase()}var N=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],J=/[^A-Z0-9]+/gi;function v(e,t,r){return t instanceof RegExp?e.replace(t,r):t.reduce((function(n,s){return n.replace(s,r)}),e)}function p(e,t){return t===void 0&&(t={}),(function(r,n){n===void 0&&(n={});for(var s=n.splitRegexp,a=s===void 0?N:s,c=n.stripRegexp,d=c===void 0?J:c,S=n.transform,P=S===void 0?A:S,U=n.delimiter,L=U===void 0?" ":U,H=v(v(r,a,"$1\0$2"),d,"\0"),Z=0,B=H.length;H.charAt(Z)==="\0";)Z++;for(;H.charAt(B-1)==="\0";)B--;return H.slice(Z,B).split("\0").map(P).join(L)})(e,M({delimiter:"."},t))}var _=ht(729),u=ht.n(_);function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const y=navigator.platform.toLowerCase()==="win32"?z.win32:z.posix,E=function(e,t){return t===void 0&&(t={}),p(e,M({delimiter:"_"},t))};class R extends u(){constructor(t,r){super(),w(this,"_tag",void 0),w(this,"_opts",void 0),w(this,"_logs",[]),this._tag=t,this._opts=r}write(t,r,n){var s;r!=null&&r.length&&r[r.length-1]===!0&&(n=!0,r.pop());const a=r.reduce(((d,S)=>(S&&S instanceof Error?d+=`${S.message} ${S.stack}`:d+=S.toString(),d)),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var c;this._logs.push([t,a]),(n||(s=this._opts)!==null&&s!==void 0&&s.console)&&((c=console)===null||c===void 0||c[t==="ERROR"?"error":"debug"](`${t}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function j(e,...t){try{const r=new URL(e);if(!r.origin)throw new Error(null);const n=y.join(e.substr(r.origin.length),...t);return r.origin+n}catch{return y.join(e,...t)}}function T(e,t){let r,n,s=!1;const a=d=>S=>{e&&clearTimeout(e),d(S),s=!0},c=new Promise(((d,S)=>{r=a(d),n=a(S),e&&(e=setTimeout((()=>n(new Error(`[deferred timeout] ${t}`))),e))}));return{created:Date.now(),setTag:d=>t=d,resolve:r,reject:n,promise:c,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var l=ht(227),m=ht.n(l);function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const q="application/x-postmate-v1+json";let K=0;const et={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},at=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===q&&!!et[e.data.postmate];class gt{constructor(t){g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"events",{}),g(this,"childOrigin",void 0),g(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=r=>{if(!at(r,this.childOrigin))return!1;const{data:n,name:s}=((r||{}).data||{}).value||{};r.data.postmate==="emit"&&s in this.events&&this.events[s].forEach((a=>{a.call(this,n)}))},this.parent.addEventListener("message",this.listener,!1)}get(t,...r){return new Promise(((n,s)=>{const a=++K,c=d=>{d.data.uid===a&&d.data.postmate==="reply"&&(this.parent.removeEventListener("message",c,!1),d.data.error?s(d.data.error):n(d.data.value))};this.parent.addEventListener("message",c,!1),this.child.postMessage({postmate:"request",type:q,property:t,args:r,uid:a},this.childOrigin)}))}call(t,r){this.child.postMessage({postmate:"call",type:q,property:t,data:r},this.childOrigin)}on(t,r){this.events[t]||(this.events[t]=[]),this.events[t].push(r)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class vt{constructor(t){g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),g(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",(r=>{if(!at(r,this.parentOrigin))return;const{property:n,uid:s,data:a,args:c}=r.data;r.data.postmate!=="call"?((d,S,P)=>{const U=typeof d[S]=="function"?d[S].apply(null,P):d[S];return Promise.resolve(U)})(this.model,n,c).then((d=>{r.source.postMessage({property:n,postmate:"reply",type:q,uid:s,value:d},r.origin)})).catch((d=>{r.source.postMessage({property:n,postmate:"reply",type:q,uid:s,error:d},r.origin)})):n in this.model&&typeof this.model[n]=="function"&&this.model[n](a)}))}emit(t,r){this.parent.postMessage({postmate:"emit",type:q,value:{name:t,data:r}},this.parentOrigin)}}class dt{constructor(t){g(this,"container",void 0),g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"childOrigin",void 0),g(this,"url",void 0),g(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){const r=(a=>{const c=document.createElement("a");c.href=a;const d=c.protocol.length>4?c.protocol:window.location.protocol,S=c.host.length?c.port==="80"||c.port==="443"?c.hostname:c.host:window.location.host;return c.origin||`${d}//${S}`})(t=t||this.url);let n,s=0;return new Promise(((a,c)=>{const d=P=>!!at(P,r)&&(P.data.postmate==="handshake-reply"?(clearInterval(n),this.parent.removeEventListener("message",d,!1),this.childOrigin=P.origin,a(new gt(this))):c("Failed handshake"));this.parent.addEventListener("message",d,!1);const S=()=>{s++,this.child.postMessage({postmate:"handshake",type:q,model:this.model},r),s===5&&clearInterval(n)};this.frame.addEventListener("load",(()=>{S(),n=setInterval(S,500)})),this.frame.src=t}))}destroy(){this.frame.parentNode.removeChild(this.frame)}}g(dt,"debug",!1),g(dt,"Model",void 0);class we{constructor(t){g(this,"child",void 0),g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise(((t,r)=>{const n=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",n,!1),s.source.postMessage({postmate:"handshake-reply",type:q},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach((c=>{this.model[c]=a[c]})),t(new vt(this))}return r("Handshake Reply Failed")}};this.child.addEventListener("message",n,!1)}))}}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{importHTML:b,createSandboxContainer:D}=window.QSandbox||{};function V(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise((async(r,n)=>{try{const s=await window.apis.doAction(["readFile",e]);r({text:()=>s})}catch(s){console.error(s),n(s)}})))}class bt extends u(){constructor(t){super(),f(this,"_pluginLocal",void 0),f(this,"_frame",void 0),f(this,"_root",void 0),f(this,"_loaded",!1),f(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose((()=>{this._unmount()}))}async load(){const{name:t,entry:r}=this._pluginLocal.options;if(this.loaded||!r)return;const{template:n,execScripts:s}=await b(r,{fetch:V});this._mount(n,document.body);const a=D(t,{elementGetter:()=>{var d;return(d=this._root)===null||d===void 0?void 0:d.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new qr(this._pluginLocal.toJSON(),this._pluginLocal.caller);const c=await s(a,!0);this._unmountFns.push(c.unmount),this._loaded=!0}_mount(t,r){const n=this._frame=document.createElement("div");n.classList.add("lsp-shadow-sandbox"),n.id=this._pluginLocal.id,this._root=n.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,r.appendChild(n),this.emit("mounted")}_unmount(){for(const t of this._unmountFns)t&&t.call(null)}destroy(){var t,r;(t=this.frame)===null||t===void 0||(r=t.parentNode)===null||r===void 0||r.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const W=m()("LSPlugin:caller"),tt="#await#response#",xt="#lspmsg#",yt="#lspmsg#error#",jt=e=>`#lspmsg#${e}`;class Kt extends u(){constructor(t){super(),F(this,"_pluginLocal",void 0),F(this,"_connected",!1),F(this,"_parent",void 0),F(this,"_child",void 0),F(this,"_shadow",void 0),F(this,"_status",void 0),F(this,"_userModel",{}),F(this,"_call",void 0),F(this,"_callUserModel",void 0),F(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;const r=this,n=this._pluginLocal!=null;let s=0;const a=new Map,c=T(6e4),d=this._extendUserModel({"#lspmsg#ready#":async U=>{d[jt(U?.pid)]=({type:L,payload:H})=>{W(`[host (_call) -> *user] ${this._debugTag}`,L,H),r.emit(L,H)},await c.resolve()},"#lspmsg#beforeunload#":async U=>{const L=T(1e4);r.emit("beforeunload",Object.assign({actor:L},U)),await L.promise},"#lspmsg#settings#":async({type:U,payload:L})=>{r.emit("settings:changed",L)},[xt]:async({ns:U,type:L,payload:H})=>{W(`[host (async) -> *user] ${this._debugTag} ns=${U} type=${L}`,H),U&&U.startsWith("hook")?r.emit(`${U}:${L}`,H):r.emit(L,H)},"#lspmsg#reply#":({_sync:U,result:L})=>{if(W(`[sync host -> *user] #${U}`,L),a.has(U)){const H=a.get(U);H&&(L!=null&&L.hasOwnProperty(yt)?H.reject(L[yt]):H.resolve(L),a.delete(U))}},...t});var S;if(n)return await c.promise,JSON.parse(JSON.stringify((S=this._pluginLocal)===null||S===void 0?void 0:S.toJSON()));const P=new we(d).sendHandshakeReply();return this._status="pending",await P.then((U=>{this._child=U,this._connected=!0,this._call=async(L,H={},Z)=>{if(Z){const B=++s;a.set(B,Z),H._sync=B,Z.setTag(`async call #${B}`),W(`async call #${B}`)}return U.emit(jt(d.baseInfo.id),{type:L,payload:H}),Z?.promise},this._callUserModel=async(L,H)=>{try{d[L](H)}catch{W(`[model method] #${L} not existed`)}},setInterval((()=>{if(a.size>100)for(const[L,H]of a)H.settled&&a.delete(L)}),18e5)})).finally((()=>{this._status=void 0})),await c.promise,d.baseInfo}async call(t,r={}){var n;return(n=this._call)===null||n===void 0?void 0:n.call(this,t,r)}async callAsync(t,r={}){var n;const s=T(1e4);return(n=this._call)===null||n===void 0?void 0:n.call(this,t,r,s)}async callUserModel(t,...r){var n;return(n=this._callUserModel)===null||n===void 0?void 0:n.apply(this,[t,...r])}async callUserModelAsync(t,...r){var n;return t=`${tt}${t}`,(n=this._callUserModel)===null||n===void 0?void 0:n.apply(this,[t,...r])}async _setupIframeSandbox(){const t=this._pluginLocal,r=t.id,n=`${r}_lsp_main`,s=new URL(t.options.entry);s.searchParams.set("__v__",t.options.version);const a=document.querySelector(`#${n}`);a&&a.parentElement.removeChild(a);const c=document.createElement("div");c.classList.add("lsp-iframe-sandbox-container"),c.id=n,c.dataset.pid=r;try{var d;const L=(d=await this._pluginLocal._loadLayoutsData())===null||d===void 0?void 0:d.$$0;if(L){c.dataset.inited_layout="true";let{width:H,height:Z,left:B,top:X,vw:rt,vh:pt}=L;B=Math.max(B,0),B=typeof rt=="number"?`${Math.min(100*B/rt,99)}%`:`${B}px`,X=Math.max(X,45),X=typeof pt=="number"?`${Math.min(100*X/pt,99)}%`:`${X}px`,Object.assign(c.style,{width:H+"px",height:Z+"px",left:B,top:X})}}catch(L){console.error("[Restore Layout Error]",L)}document.body.appendChild(c);const S=new dt({id:r+"_iframe",container:c,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}});let P,U=S.sendHandshake();return this._status="pending",new Promise(((L,H)=>{P=setTimeout((()=>{H(new Error("handshake Timeout")),S.destroy()}),4e3),U.then((Z=>{this._parent=Z,this._connected=!0,this.emit("connected"),Z.on(jt(t.id),(({type:B,payload:X})=>{var rt,pt;W("[user -> *host] ",B,X),(rt=this._pluginLocal)===null||rt===void 0||rt.emit(B,X||{}),(pt=this._pluginLocal)===null||pt===void 0||pt.caller.emit(B,X||{})})),this._call=async(...B)=>{await Z.call(jt(t.id),{type:B[0],payload:Object.assign(B[1]||{},{$$pid:t.id})})},this._callUserModel=async(B,...X)=>{if(B.startsWith(tt))return await Z.get(B.replace(tt,""),...X);Z.call(B,X?.[0])},L(null)})).catch((Z=>{H(Z)})).finally((()=>{clearTimeout(P)}))})).catch((L=>{throw W("[iframe sandbox] error",L),L})).finally((()=>{this._status=void 0}))}async _setupShadowSandbox(){const t=this._pluginLocal,r=this._shadow=new bt(t);try{this._status="pending",await r.load(),this._connected=!0,this.emit("connected"),this._call=async(n,s={},a)=>{var c;return a&&(s.actor=a),(c=this._pluginLocal)===null||c===void 0||c.emit(n,Object.assign(s,{$$pid:t.id})),a?.promise},this._callUserModel=async(...n)=>{var s;let a=n[0];(s=a)!==null&&s!==void 0&&s.startsWith(tt)&&(a=a.replace(tt,""));const c=n[1]||{},d=this._userModel[a];typeof d=="function"&&await d.call(null,c)}}catch(n){throw W("[shadow sandbox] error",n),n}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let r=null;this._parent&&(r=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(r=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=r)===null||t===void 0||t.parentNode.removeChild(r)}}function it(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class nt{constructor(t,r){it(this,"ctx",void 0),it(this,"opts",void 0),this.ctx=t,this.opts=r}get ctxId(){return this.ctx.baseInfo.id}setItem(t,r){var n;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,r,(n=this.opts)===null||n===void 0?void 0:n.assets]})}getItem(t){var r;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(r=this.opts)===null||r===void 0?void 0:r.assets]})}removeItem(t){var r;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(r=this.opts)===null||r===void 0?void 0:r.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var r;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(r=this.opts)===null||r===void 0?void 0:r.assets]})}}class _t{constructor(t){var r,n,s;s=void 0,(n="ctx")in(r=this)?Object.defineProperty(r,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[n]=s,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...r){var n,s;const a=this.ensureHostScope();return t=(n=E(t))===null||n===void 0?void 0:n.toLowerCase(),(s=a.logseq.api["exper_"+t])===null||s===void 0?void 0:s.apply(a,r)}async loadScripts(...t){(t=t.map((r=>r!=null&&r.startsWith("http")?r:this.ctx.resolveResourceFullUrl(r)))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,r){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,r)}registerExtensionsEnhancer(t,r){const n=this.ensureHostScope();return t==="katex"&&n.katex&&r(n.katex).catch(console.error),n.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,r)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Ct(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const It=e=>`task_callback_${e}`;class Wt{constructor(t,r,n={}){Ct(this,"_client",void 0),Ct(this,"_requestId",void 0),Ct(this,"_requestOptions",void 0),Ct(this,"_promise",void 0),Ct(this,"_aborted",!1),this._client=t,this._requestId=r,this._requestOptions=n,this._promise=new Promise(((d,S)=>{if(!this._requestId)return S(null);this._client.once(It(this._requestId),(P=>{P&&P instanceof Error?S(P):d(P)}))}));const{success:s,fail:a,final:c}=this._requestOptions;this._promise.then((d=>{s?.(d)})).catch((d=>{a?.(d)})).finally((()=>{c?.()}))}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Et extends _.EventEmitter{constructor(t){super(),Ct(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",(r=>{const n=r?.requestId;n&&this.emit(It(n),r?.payload)}))}static createRequestTask(t,r,n){return new Wt(t,r,n)}async _request(t){const r=this.ctx.baseInfo.id,{success:n,fail:s,final:a,...c}=t,d=this.ctx.Experiments.invokeExperMethod("request",r,c),S=Et.createRequestTask(this.ctx.Request,d,t);return c.abortable?S:S.promise}get ctx(){return this._ctx}}const St=Array.isArray,ce=typeof yr=="object"&&yr&&yr.Object===Object&&yr;var br=typeof self=="object"&&self&&self.Object===Object&&self;const Mt=ce||br||Function("return this")(),$t=Mt.Symbol;var Je=Object.prototype,_r=Je.hasOwnProperty,wr=Je.toString,le=$t?$t.toStringTag:void 0;const xr=function(e){var t=_r.call(e,le),r=e[le];try{e[le]=void 0;var n=!0}catch{}var s=wr.call(e);return n&&(t?e[le]=r:delete e[le]),s};var Ze=Object.prototype.toString;const C=function(e){return Ze.call(e)};var I=$t?$t.toStringTag:void 0;const $=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":I&&I in Object(e)?xr(e):C(e)},G=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},ct=function(e){if(!G(e))return!1;var t=$(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Ft=Mt["__core-js_shared__"];var zt,Yt=(zt=/[^.]+$/.exec(Ft&&Ft.keys&&Ft.keys.IE_PROTO||""))?"Symbol(src)_1."+zt:"";const Me=function(e){return!!Yt&&Yt in e};var Ve=Function.prototype.toString;const Gt=function(e){if(e!=null){try{return Ve.call(e)}catch{}try{return e+""}catch{}}return""};var Cr=/^\[object .+?Constructor\]$/,Sr=Function.prototype,Or=Object.prototype,xe=Sr.toString,Ar=Or.hasOwnProperty,jr=RegExp("^"+xe.call(Ar).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Er=function(e){return!(!G(e)||Me(e))&&(ct(e)?jr:Cr).test(Gt(e))},Fe=function(e,t){return e?.[t]},Lt=function(e,t){var r=Fe(e,t);return Er(r)?r:void 0},Nt=(function(){try{var e=Lt(Object,"defineProperty");return e({},"",{}),e}catch{}})(),Ke=function(e,t,r){t=="__proto__"&&Nt?Nt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},Ce=(function(e){return function(t,r,n){for(var s=-1,a=Object(t),c=n(t),d=c.length;d--;){var S=c[++s];if(r(a[S],S,a)===!1)break}return t}})(),Le=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},Qt=function(e){return e!=null&&typeof e=="object"},Ye=function(e){return Qt(e)&&$(e)=="[object Arguments]"};var Qe=Object.prototype,kr=Qe.hasOwnProperty,Xe=Qe.propertyIsEnumerable;const kt=Ye((function(){return arguments})())?Ye:function(e){return Qt(e)&&kr.call(e,"callee")&&!Xe.call(e,"callee")},ue=function(){return!1};var Ht=_e&&!_e.nodeType&&_e,Se=Ht&&!0&&At&&!At.nodeType&&At,Oe=Se&&Se.exports===Ht?Mt.Buffer:void 0;const Ne=(Oe?Oe.isBuffer:void 0)||ue;var Tr=/^(?:0|[1-9]\d*)$/;const tr=function(e,t){var r=typeof e;return!!(t=t??9007199254740991)&&(r=="number"||r!="symbol"&&Tr.test(e))&&e>-1&&e%1==0&&e<t},Ae=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var Y={};Y["[object Float32Array]"]=Y["[object Float64Array]"]=Y["[object Int8Array]"]=Y["[object Int16Array]"]=Y["[object Int32Array]"]=Y["[object Uint8Array]"]=Y["[object Uint8ClampedArray]"]=Y["[object Uint16Array]"]=Y["[object Uint32Array]"]=!0,Y["[object Arguments]"]=Y["[object Array]"]=Y["[object ArrayBuffer]"]=Y["[object Boolean]"]=Y["[object DataView]"]=Y["[object Date]"]=Y["[object Error]"]=Y["[object Function]"]=Y["[object Map]"]=Y["[object Number]"]=Y["[object Object]"]=Y["[object RegExp]"]=Y["[object Set]"]=Y["[object String]"]=Y["[object WeakMap]"]=!1;const lt=function(e){return Qt(e)&&Ae(e.length)&&!!Y[$(e)]},er=function(e){return function(t){return e(t)}};var ut=_e&&!_e.nodeType&&_e,Xt=ut&&!0&&At&&!At.nodeType&&At,ot=Xt&&Xt.exports===ut&&ce.process,te=(function(){try{var e=Xt&&Xt.require&&Xt.require("util").types;return e||ot&&ot.binding&&ot.binding("util")}catch{}})(),je=te&&te.isTypedArray;const Pe=je?er(je):lt;var Re=Object.prototype.hasOwnProperty;const rr=function(e,t){var r=St(e),n=!r&&kt(e),s=!r&&!n&&Ne(e),a=!r&&!n&&!s&&Pe(e),c=r||n||s||a,d=c?Le(e.length,String):[],S=d.length;for(var P in e)!Re.call(e,P)||c&&(P=="length"||s&&(P=="offset"||P=="parent")||a&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||tr(P,S))||d.push(P);return d};var ee=Object.prototype;const Jt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||ee)},De=(function(e,t){return function(r){return e(t(r))}})(Object.keys,Object);var Ue=Object.prototype.hasOwnProperty;const re=function(e){if(!Jt(e))return De(e);var t=[];for(var r in Object(e))Ue.call(e,r)&&r!="constructor"&&t.push(r);return t},Ee=function(e){return e!=null&&Ae(e.length)&&!ct(e)},ne=function(e){return Ee(e)?rr(e):re(e)},nr=function(e,t){return e&&Ce(e,t,ne)},$e=function(){this.__data__=[],this.size=0},oe=function(e,t){return e===t||e!=e&&t!=t},Pt=function(e,t){for(var r=e.length;r--;)if(oe(e[r][0],t))return r;return-1};var ie=Array.prototype.splice;const or=function(e){var t=this.__data__,r=Pt(t,e);return!(r<0)&&(r==t.length-1?t.pop():ie.call(t,r,1),--this.size,!0)},ir=function(e){var t=this.__data__,r=Pt(t,e);return r<0?void 0:t[r][1]},sr=function(e){return Pt(this.__data__,e)>-1},ze=function(e,t){var r=this.__data__,n=Pt(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Zt(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Zt.prototype.clear=$e,Zt.prototype.delete=or,Zt.prototype.get=ir,Zt.prototype.has=sr,Zt.prototype.set=ze;const se=Zt,He=function(){this.__data__=new se,this.size=0},qt=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},ke=function(e){return this.__data__.get(e)},ar=function(e){return this.__data__.has(e)},fe=Lt(Mt,"Map"),pe=Lt(Object,"create"),ae=function(){this.__data__=pe?pe(null):{},this.size=0},Ir=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var cr=Object.prototype.hasOwnProperty;const qe=function(e){var t=this.__data__;if(pe){var r=t[e];return r==="__lodash_hash_undefined__"?void 0:r}return cr.call(t,e)?t[e]:void 0};var lr=Object.prototype.hasOwnProperty;const ur=function(e){var t=this.__data__;return pe?t[e]!==void 0:lr.call(t,e)},Mr=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=pe&&t===void 0?"__lodash_hash_undefined__":t,this};function Rt(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Rt.prototype.clear=ae,Rt.prototype.delete=Ir,Rt.prototype.get=qe,Rt.prototype.has=ur,Rt.prototype.set=Mr;const Te=Rt,Fr=function(){this.size=0,this.__data__={hash:new Te,map:new(fe||se),string:new Te}},Dt=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},he=function(e,t){var r=e.__data__;return Dt(t)?r[typeof t=="string"?"string":"hash"]:r.map},fr=function(e){var t=he(this,e).delete(e);return this.size-=t?1:0,t},pr=function(e){return he(this,e).get(e)},Lr=function(e){return he(this,e).has(e)},de=function(e,t){var r=he(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function wt(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}wt.prototype.clear=Fr,wt.prototype.delete=fr,wt.prototype.get=pr,wt.prototype.has=Lr,wt.prototype.set=de;const me=wt,hr=function(e,t){var r=this.__data__;if(r instanceof se){var n=r.__data__;if(!fe||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new me(n)}return r.set(e,t),this.size=r.size,this};function Vt(e){var t=this.__data__=new se(e);this.size=t.size}Vt.prototype.clear=He,Vt.prototype.delete=qt,Vt.prototype.get=ke,Vt.prototype.has=ar,Vt.prototype.set=hr;const ge=Vt,Nr=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function O(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new me;++t<r;)this.add(e[t])}O.prototype.add=O.prototype.push=Nr,O.prototype.has=o;const x=O,Q=function(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1},st=function(e,t){return e.has(t)},mt=function(e,t,r,n,s,a){var c=1&r,d=e.length,S=t.length;if(d!=S&&!(c&&S>d))return!1;var P=a.get(e),U=a.get(t);if(P&&U)return P==t&&U==e;var L=-1,H=!0,Z=2&r?new x:void 0;for(a.set(e,t),a.set(t,e);++L<d;){var B=e[L],X=t[L];if(n)var rt=c?n(X,B,L,t,e,a):n(B,X,L,e,t,a);if(rt!==void 0){if(rt)continue;H=!1;break}if(Z){if(!Q(t,(function(pt,Tt){if(!st(Z,Tt)&&(B===pt||s(B,pt,r,n,a)))return Z.push(Tt)}))){H=!1;break}}else if(B!==X&&!s(B,X,r,n,a)){H=!1;break}}return a.delete(e),a.delete(t),H},ft=Mt.Uint8Array,ye=function(e){var t=-1,r=Array(e.size);return e.forEach((function(n,s){r[++t]=[s,n]})),r},Bt=function(e){var t=-1,r=Array(e.size);return e.forEach((function(n){r[++t]=n})),r};var Ot=$t?$t.prototype:void 0,Be=Ot?Ot.valueOf:void 0;const Wr=function(e,t,r,n,s,a,c){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new ft(e),new ft(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return oe(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var d=ye;case"[object Set]":var S=1&n;if(d||(d=Bt),e.size!=t.size&&!S)return!1;var P=c.get(e);if(P)return P==t;n|=2,c.set(e,t);var U=mt(d(e),d(t),n,s,a,c);return c.delete(e),U;case"[object Symbol]":if(Be)return Be.call(e)==Be.call(t)}return!1},vn=function(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e},bn=function(e,t,r){var n=t(e);return St(e)?n:vn(n,r(e))},_n=function(e,t){for(var r=-1,n=e==null?0:e.length,s=0,a=[];++r<n;){var c=e[r];t(c,r,e)&&(a[s++]=c)}return a},wn=function(){return[]};var xn=Object.prototype.propertyIsEnumerable,Gr=Object.getOwnPropertySymbols;const Cn=Gr?function(e){return e==null?[]:(e=Object(e),_n(Gr(e),(function(t){return xn.call(e,t)})))}:wn,Jr=function(e){return bn(e,ne,Cn)};var Sn=Object.prototype.hasOwnProperty;const On=function(e,t,r,n,s,a){var c=1&r,d=Jr(e),S=d.length;if(S!=Jr(t).length&&!c)return!1;for(var P=S;P--;){var U=d[P];if(!(c?U in t:Sn.call(t,U)))return!1}var L=a.get(e),H=a.get(t);if(L&&H)return L==t&&H==e;var Z=!0;a.set(e,t),a.set(t,e);for(var B=c;++P<S;){var X=e[U=d[P]],rt=t[U];if(n)var pt=c?n(rt,X,U,t,e,a):n(X,rt,U,e,t,a);if(!(pt===void 0?X===rt||s(X,rt,r,n,a):pt)){Z=!1;break}B||(B=U=="constructor")}if(Z&&!B){var Tt=e.constructor,be=t.constructor;Tt==be||!("constructor"in e)||!("constructor"in t)||typeof Tt=="function"&&Tt instanceof Tt&&typeof be=="function"&&be instanceof be||(Z=!1)}return a.delete(e),a.delete(t),Z},Pr=Lt(Mt,"DataView"),Rr=Lt(Mt,"Promise"),Dr=Lt(Mt,"Set"),Ur=Lt(Mt,"WeakMap");var Zr="[object Map]",Vr="[object Promise]",Kr="[object Set]",Yr="[object WeakMap]",Qr="[object DataView]",An=Gt(Pr),jn=Gt(fe),En=Gt(Rr),kn=Gt(Dr),Tn=Gt(Ur),ve=$;(Pr&&ve(new Pr(new ArrayBuffer(1)))!=Qr||fe&&ve(new fe)!=Zr||Rr&&ve(Rr.resolve())!=Vr||Dr&&ve(new Dr)!=Kr||Ur&&ve(new Ur)!=Yr)&&(ve=function(e){var t=$(e),r=t=="[object Object]"?e.constructor:void 0,n=r?Gt(r):"";if(n)switch(n){case An:return Qr;case jn:return Zr;case En:return Vr;case kn:return Kr;case Tn:return Yr}return t});const Xr=ve;var tn="[object Arguments]",en="[object Array]",dr="[object Object]",rn=Object.prototype.hasOwnProperty;const In=function(e,t,r,n,s,a){var c=St(e),d=St(t),S=c?en:Xr(e),P=d?en:Xr(t),U=(S=S==tn?dr:S)==dr,L=(P=P==tn?dr:P)==dr,H=S==P;if(H&&Ne(e)){if(!Ne(t))return!1;c=!0,U=!1}if(H&&!U)return a||(a=new ge),c||Pe(e)?mt(e,t,r,n,s,a):Wr(e,t,S,r,n,s,a);if(!(1&r)){var Z=U&&rn.call(e,"__wrapped__"),B=L&&rn.call(t,"__wrapped__");if(Z||B){var X=Z?e.value():e,rt=B?t.value():t;return a||(a=new ge),s(X,rt,r,n,a)}}return!!H&&(a||(a=new ge),On(e,t,r,n,s,a))},nn=function e(t,r,n,s,a){return t===r||(t==null||r==null||!Qt(t)&&!Qt(r)?t!=t&&r!=r:In(t,r,n,s,e,a))},Mn=function(e,t,r,n){var s=r.length,a=s;if(e==null)return!a;for(e=Object(e);s--;){var c=r[s];if(c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<a;){var d=(c=r[s])[0],S=e[d],P=c[1];if(c[2]){if(S===void 0&&!(d in e))return!1}else{var U=new ge,L;if(!(L===void 0?nn(P,S,3,n,U):L))return!1}}return!0},on=function(e){return e==e&&!G(e)},Fn=function(e){for(var t=ne(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,on(s)]}return t},sn=function(e,t){return function(r){return r!=null&&r[e]===t&&(t!==void 0||e in Object(r))}},Ln=function(e){var t=Fn(e);return t.length==1&&t[0][2]?sn(t[0][0],t[0][1]):function(r){return r===e||Mn(r,e,t)}},$r=function(e){return typeof e=="symbol"||Qt(e)&&$(e)=="[object Symbol]"};var Nn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pn=/^\w*$/;const zr=function(e,t){if(St(e))return!1;var r=typeof e;return!(r!="number"&&r!="symbol"&&r!="boolean"&&e!=null&&!$r(e))||Pn.test(e)||!Nn.test(e)||t!=null&&e in Object(t)};function Hr(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],a=r.cache;if(a.has(s))return a.get(s);var c=e.apply(this,n);return r.cache=a.set(s,c)||a,c};return r.cache=new(Hr.Cache||me),r}Hr.Cache=me;const Rn=Hr;var Dn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Un=/\\(\\)?/g;const $n=(function(e){var t=Rn(e,(function(n){return r.size===500&&r.clear(),n})),r=t.cache;return t})((function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Dn,(function(r,n,s,a){t.push(s?a.replace(Un,"$1"):n||r)})),t})),zn=function(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s};var an=$t?$t.prototype:void 0,cn=an?an.toString:void 0;const Hn=function e(t){if(typeof t=="string")return t;if(St(t))return zn(t,e)+"";if($r(t))return cn?cn.call(t):"";var r=t+"";return r=="0"&&1/t==-1/0?"-0":r},qn=function(e){return e==null?"":Hn(e)},ln=function(e,t){return St(e)?e:zr(e,t)?[e]:$n(qn(e))},mr=function(e){if(typeof e=="string"||$r(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},un=function(e,t){for(var r=0,n=(t=ln(t,e)).length;e!=null&&r<n;)e=e[mr(t[r++])];return r&&r==n?e:void 0},Bn=function(e,t,r){var n=e==null?void 0:un(e,t);return n===void 0?r:n},Wn=function(e,t){return e!=null&&t in Object(e)},Gn=function(e,t,r){for(var n=-1,s=(t=ln(t,e)).length,a=!1;++n<s;){var c=mr(t[n]);if(!(a=e!=null&&r(e,c)))break;e=e[c]}return a||++n!=s?a:!!(s=e==null?0:e.length)&&Ae(s)&&tr(c,s)&&(St(e)||kt(e))},Jn=function(e,t){return e!=null&&Gn(e,t,Wn)},Zn=function(e,t){return zr(e)&&on(t)?sn(mr(e),t):function(r){var n=Bn(r,e);return n===void 0&&n===t?Jn(r,e):nn(t,n,3)}},Vn=function(e){return e},Kn=function(e){return function(t){return t?.[e]}},Yn=function(e){return function(t){return un(t,e)}},Qn=function(e){return zr(e)?Kn(mr(e)):Yn(e)},Xn=function(e){return typeof e=="function"?e:e==null?Vn:typeof e=="object"?St(e)?Zn(e[0],e[1]):Ln(e):Qn(e)},to=function(e,t){var r={};return t=Xn(t),nr(e,(function(n,s,a){Ke(r,t(n,s,a),n)})),r};function fn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class eo{constructor(t,r){fn(this,"ctx",void 0),fn(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=r,t._execCallableAPI("register-search-service",t.baseInfo.id,r.name,r.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:n=>(St(n?.blocks)&&(n.blocks=n.blocks.map((s=>s&&to(s,((a,c)=>`block/${c}`))))),n)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach((([n,s])=>{const a=(c=>`service:search:${c}:${r.name}`)(n);t.caller.on(a,(async c=>{if(ct(r?.[s.f])){let d=null;try{d=await r[s.f].apply(r,(s.args||[]).map((S=>{if(c){if(S===!0)return c;if(c.hasOwnProperty(S)){const P=c[S];return delete c[S],P}}}))),s.transformOutput&&(d=s.transformOutput(d))}catch(S){console.error("[SearchService] ",S),d=S}finally{s.reply&&t.caller.call(`${a}:reply`,d)}}}))}))}}function Ut(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ro=Symbol.for("proxy-continue"),no=m()("LSPlugin:user"),pn=new R("",{console:!0});function Ie(e,t,r){var n;const{key:s,label:a,desc:c,palette:d,keybinding:S,extras:P}=t;if(typeof r!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const U=(function(H){if(typeof H=="string")return H.trim().replace(/\s/g,"_").toLowerCase()})(s);if(!U)return this.logger.error(`${a}: command key is required.`),!1;const L=`SimpleCommandHook${U}${++mn}`;this.Editor["on"+L](r),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:U,label:a,type:e,desc:c,keybinding:S,extras:P},["editor/hook",L]],d]})}function hn(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(pn.error(`#${e} is not a valid UUID string.`),!1);var t}let gr=null,dn=new Map;const oo={async getInfo(e){return gr||(gr=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?gr[e]:gr},registerCommand:Ie,registerSearchService(e){if(dn.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);dn.set(e.name,new eo(this,e))},registerCommandPalette(e,t){const{key:r,label:n,keybinding:s}=e;return Ie.call(this,"$palette$",{key:r,label:n,palette:!0,keybinding:s},t)},registerCommandShortcut(e,t,r={}){typeof e=="string"&&(e={mode:"global",binding:e});const{binding:n}=e,s="$shortcut$",a=r.key||s+E(n?.toString());return Ie.call(this,s,{...r,key:a,palette:!1,keybinding:e},t)},registerUIItem(e,t){var r;const n=this.baseInfo.id;(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-ui-item",args:[n,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id,n=e;Ie.call(this,"page-menu-item",{key:r,label:n},t)},onBlockRendererSlotted(e,t){if(!hn(e))return;const r=this.baseInfo.id,n=`hook:editor:${E(`slot:${e}`)}`;return this.caller.on(n,t),this.App._installPluginHook(r,n),()=>{this.caller.off(n,t),this.App._uninstallPluginHook(r,n)}},invokeExternalPlugin(e,...t){var r;if(!(e=(r=e)===null||r===void 0?void 0:r.trim()))return;let[n,s]=e.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=e.replace(`${n}.${s}.`,"");if(!n||!s||!a)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",n,s.toLowerCase(),a,t)},setFullScreen(e){const t=(...r)=>this._callWin("setFullScreen",...r);e==="toggle"?this._callWin("isFullScreen").then((r=>{r?t():t(!0)})):e?t(!0):t()}};let mn=0;const io={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var r;no("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map((n=>{const[s,...a]=n;if(s==="editor/hook"){let c=a[0],d=()=>{var P;(P=this.caller)===null||P===void 0||P.callUserModel(c)};typeof c=="function"&&(d=c);const S=`SlashCommandHook${s}${++mn}`;n[1]=S,this.Editor["on"+S](d)}return n})),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id;Ie.call(this,"block-context-menu-item",{key:r,label:e},t)},registerHighlightContextMenuItem(e,t,r){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id;Ie.call(this,"highlight-context-menu-item",{key:n,label:e,extras:r},t)},scrollToBlockInPage(e,t,r){const n="block-content-"+t;r!=null&&r.replaceState?this.App.replaceState("page",{name:e},{anchor:n}):this.App.pushState("page",{name:e},{anchor:n})}},so={onBlockChanged(e,t){if(!hn(e))return;const r=this.baseInfo.id,n=`hook:db:${E(`block:${e}`)}`,s=({block:a,txData:c,txMeta:d})=>{a.uuid===e&&t(a,c,d)};return this.caller.on(n,s),this.App._installPluginHook(r,n),()=>{this.caller.off(n,s),this.App._uninstallPluginHook(r,n)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some((r=>typeof r=="function"))?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},ao={},co={},lo={makeSandboxStorage(){return new nt(this,{assets:!0})}};class qr extends u(){constructor(t,r){super(),Ut(this,"_baseInfo",void 0),Ut(this,"_caller",void 0),Ut(this,"_version","0.0.17"),Ut(this,"_debugTag",""),Ut(this,"_settingsSchema",void 0),Ut(this,"_connected",!1),Ut(this,"_ui",new Map),Ut(this,"_mFileStorage",void 0),Ut(this,"_mRequest",void 0),Ut(this,"_mExperiments",void 0),Ut(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=r,r.on("sys:ui:visible",(n=>{n!=null&&n.toggle&&this.toggleMainUI()})),r.on("settings:changed",(n=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,n);this.emit("settings:changed",{...a},s)})),r.on("beforeunload",(async n=>{const{actor:s,...a}=n,c=this._beforeunloadCallback;try{c&&await c(a),s?.resolve(null)}catch(d){this.logger.error("[beforeunload] ",d),s?.reject(d)}}))}async ready(t,r){var n,s;if(!this._connected)try{var a;typeof t=="function"&&(r=t,t={});let c=await this._caller.connectToParent(t);this._connected=!0,n=this._baseInfo,s=c,c=k()(n,s,{arrayMerge:(d,S)=>S}),this._baseInfo=c,(a=c)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${c.id} [${c.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(c.settings=(function(d,S){const P=(S||[]).reduce(((U,L)=>("default"in L&&(U[L.key]=L.default),U)),{});return Object.assign(P,d)})(c.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(d){console.warn(d)}r&&r.call(this,c)}catch(c){console.error(`${this._debugTag} [Ready Error]`,c)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){const r="settings:changed";return this.on(r,t),()=>this.off(r,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){const r={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",r),this.emit("ui:visible:changed",r),this._ui.set(r.key,r)}showMainUI(t){const r={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",r),this.emit("ui:visible:changed",r),this._ui.set(r.key,r)}toggleMainUI(){const r=this._ui.get(0);r&&r.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((r=t.baseInfo)===null||r===void 0?void 0:r.effect)||!((n=t.baseInfo)!==null&&n!==void 0&&n.iir));var t,r,n}get logger(){return pn}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),j(this._baseInfo.lsr,t)}_makeUserProxy(t,r){const n=this,s=this.caller;return new Proxy(t,{get(a,c,d){const S=a[c];return function(...P){if(S){const L=S.apply(n,P.concat(r));if(L!==ro)return L}if(r){const L=c.toString().match(/^(once|off|on)/i);if(L!=null){const H=L[0].toLowerCase(),Z=L.input,B=H==="off",X=n.baseInfo.id;let rt=Z.slice(H.length),pt=P[0],Tt=P[1];typeof pt=="string"&&typeof Tt=="function"&&(pt=pt.replace(/^logseq./,":"),rt=`${rt}${pt}`,pt=Tt,Tt=P[2]),rt=`hook:${r}:${E(rt)}`,s[H](rt,pt);const be=()=>{s.off(rt,pt),s.listenerCount(rt)||n.App._uninstallPluginHook(X,rt)};return B?void be():(n.App._installPluginHook(X,rt,Tt),be)}}let U=c;return["git","ui","assets"].includes(r)&&(U=r+"_"+U),s.callAsync("api:call",{tag:r,method:U,args:P})}}})}_execCallableAPIAsync(t,...r){return this._caller.callAsync("api:call",{method:t,args:r})}_execCallableAPI(t,...r){this._caller.call("api:call",{method:t,args:r})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(oo,"app")}get Editor(){return this._makeUserProxy(io,"editor")}get DB(){return this._makeUserProxy(so,"db")}get Git(){return this._makeUserProxy(ao,"git")}get UI(){return this._makeUserProxy(co,"ui")}get Assets(){return this._makeUserProxy(lo,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new nt(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new Et(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new _t(this)),t}}function gn(e,t){return new qr(e,t)}if(window.__LSP__HOST__==null){const e=new Kt(null);window.logseq=gn({},e)}})(),vr})()))})(We,We.exports)),We.exports}export{uo as g,fo as r};
